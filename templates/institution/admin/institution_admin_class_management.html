{% extends "layouts/base.html" %}

{% block title %}Class Management - AttendAI{% endblock %}

{% block content %}
<div class="class-management">
    <h1 class="page-title mb-4">Class Management</h1>

    <div class="card-custom mb-4">
        <div class="card-header-custom">Search & Filter</div>
        <div class="card-body-custom">
            <!-- search section -->
            <div class="search-section">
                <div class="search-filters mb-3">
                    <input id="searchInput" type="text" class="search-input" placeholder="Search by class name, code, or lecturer..."> 
                </div>
            </div>
        </div>
    </div>

    <div class="card-custom">
        <div class="card-header-custom">Course List</div>
        <div class="card-body-custom">
            <div class="table-responsive">
                <table class="classes-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Code</th>
                            <th>Lecturer</th>
                            <th style="text-align: center;">Actions</th>
                        </tr>
                    </thead>

                    <tbody id="userTableBody">
                        {% for course in courses %}
                        <tr class="course-row" data-name="{{ course[1] }}" data-code="{{ course[2] }}" data-lecturer="{{ course[3] }}">
                            <td>{{ course[1] }}</td>
                            <td>{{ course[2] }}</td>
                            <td>{{ course[3] }}</td>
                            <td class="actions-cell">
                                <a href="{{ url_for('institution.module_details', course_id=course[0]) }}" class="btn-custom btn-manage">Manage</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<style>
    /* Class Management Specific Styles */
    .class-management {
        max-width: 1400px;
        margin: 0 auto;
    }

        /* .class-management {
        max-width: 1400px;
        margin: 0 auto;
    } */

    .page-title {
        font-size: 2.5rem;
        font-weight: bold;
        font-style: italic;
        color: var(--text-dark);
        border-bottom: 2px solid var(--border-color);
        padding-bottom: 1rem;
    }

     /* Search Section */
     .search-filters {
        display: flex;
        gap: 1rem;
        width: 100%;
    }

    .search-input,
    .filter-select {
        flex: 1;
        min-width: 350px;
        padding: 0.75rem 1.25rem;
        border-radius: 20px;
        font-size: 0.9rem;
        background-color: white;
    }

    .filter-select {
        cursor: pointer;
    }

    /* Table Styles */
    .table-responsive {
        overflow-x: auto;
    }

    .classes-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1rem;
    }

    .classes-table thead {
        background-color: var(--primary-dark);
        color: white;
    }

    .classes-table th {
        padding: 1rem;
        text-align: left;
        font-weight: 600;
        font-size: 0.9rem;
        border-bottom: 2px solid var(--border-color);
    }

    .classes-table td {
        padding: 1rem;
        border-bottom: 1px solid #e5e7eb;
        font-size: 0.9rem;
        vertical-align: middle;
    }

    .classes-table tbody tr:last-child td {
        border-bottom: none;
    }

    .classes-table tbody tr:hover {
        background-color: var(--primary-light);
    }

    /* Action Buttons */
    .actions-cell {
        text-align: center;
    }

    .btn-manage {
        padding: 0.5rem 1.5rem;
        border-radius: 20px;
        font-size: 0.85rem;
        background-color: var(--primary-dark);
        color: white;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .btn-manage:hover {
        background-color: #1e293b;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .page-title {
            font-size: 1.75rem;
        }

        .search-filters {
            flex-direction: column;
            align-items: stretch;
        }

        .search-input,
        .filter-input {
            min-width: 100%;
        }

        .btn-search {
            width: 100%;
        }

        .classes-table {
            font-size: 0.8rem;
        }

        .classes-table th,
        .classes-table td {
            padding: 0.75rem 0.5rem;
        }

        .classes-table th:nth-child(3),
        .classes-table td:nth-child(3) {
            display: none;
        }
    }

    @media (max-width: 480px) {
        .classes-table th:nth-child(2),
        .classes-table td:nth-child(2) {
            display: none;
        }

        .btn-manage {
            padding: 0.4rem 1rem;
            font-size: 0.8rem;
        }
    }
    </style>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('searchInput');
        const tableBody = document.getElementById('userTableBody');
        const rows = tableBody.getElementsByTagName('tr');

        function filterTable() {
            const searchTerm = searchInput.value.toLowerCase().trim();
            let visibleCount = 0;

            for (let row of rows) {
                if (row.id === 'noResultsMessage') continue;

                const name = row.getAttribute('data-name')?.toLowerCase() || '';
                const code = row.getAttribute('data-code')?.toLowerCase() || '';
                const lecturer = row.getAttribute('data-lecturer')?.toLowerCase() || '';

                const matchesSearch =
                    searchTerm === '' ||
                    name.includes(searchTerm) ||
                    code.includes(searchTerm) ||
                    lecturer.includes(searchTerm);

                if (matchesSearch) {
                    row.style.display = '';
                    visibleCount++;
                } else {
                    row.style.display = 'none';
                }
            }

            // Remove old "no results" row
            const existingMessage = document.getElementById('noResultsMessage');
            if (existingMessage) existingMessage.remove();

            // Show "No Results" only when filtering finished
            if (visibleCount === 0) {
                const messageRow = document.createElement('tr');
                messageRow.id = 'noResultsMessage';
                messageRow.innerHTML =
                    '<td colspan="4" style="text-align:center; padding:2rem; color:#6b7280;">No classes found.</td>';
                tableBody.appendChild(messageRow);
            }
        }

        searchInput.addEventListener('input', filterTable);

        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') filterTable();
        });
    });
    </script>


{% endblock %}