{% extends "layouts/base.html" %}

{% block title %}Attendance Management - AttendAI{% endblock %}

{% block content %}
<div class="attendance-management">
    <h1 class="page-title mb-4">Attendance Management</h1>

    <!-- Class Info Card -->
    <div class="class-info-card mb-4">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h2 class="class-code">{{ class.course_code }} - {{ class.section }}</h2>
                <div class="class-details">
                    <span class="class-detail-item">
                        <span class="detail-icon">üìÖ</span>
                        {{ class.date }}
                    </span>
                    <span class="class-detail-item">
                        <span class="detail-icon">üìç</span>
                        {{ class.room }}
                    </span>
                    <span class="class-detail-item">
                        <span class="detail-icon">üïê</span>
                        {{ class.time }}
                    </span>
                </div>
            </div>
            <div>
                <a href="{{ url_for('institution_lecturer.manage_classes', class_id=class.id) }}" class="btn-outline-custom">Class Details</a>
            </div>
        </div>
    </div>

    <!-- Search and Filter Section -->
    <div class="search-section mb-4">
        <div class="d-flex flex-wrap gap-3 align-items-center justify-content-between">
            <div class="d-flex flex-wrap gap-3">
                <div class="search-box">
                    <input type="text" 
                           id="searchInput" 
                           placeholder="Search by name or ID..." 
                           onkeyup="searchStudents()">
                    <span class="search-icon">üîç</span>
                </div>
                
                <div class="filter-dropdown">
                    <select id="statusFilter" class="filter-select" onchange="filterStudents()">
                        <option value="all">All Students</option>
                        <option value="present">Present Only</option>
                        <option value="absent">Absent Only</option>
                        <option value="pending">Pending Only</option>
                    </select>
                </div>
                
                <button class="btn-custom" onclick="refreshAttendance()">
                    <span class="btn-icon">üîÑ</span>
                    Refresh
                </button>
            </div>
            
            <div class="d-flex gap-3">
                <button class="btn-custom" onclick="toggleFaceRecognition()">
                    <span class="btn-icon">üì∏</span>
                    Face Recognition
                </button>
                
                <button class="btn-custom btn-success" onclick="saveAttendance()">
                    <span class="btn-icon">üíæ</span>
                    Save Attendance
                </button>
            </div>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="stats-container mb-4">
        <div class="stat-card card-custom">
            <div class="stat-icon total">üë•</div>
            <div class="stat-content">
                <h3 id="totalStudents">{{ total_students or 10 }}</h3>
                <p>Total Students</p>
            </div>
        </div>

        <div class="stat-card card-custom">
            <div class="stat-icon present">‚úì</div>
            <div class="stat-content">
                <h3 id="presentCount">0</h3>
                <p>Present</p>
            </div>
        </div>

        <div class="stat-card card-custom">
            <div class="stat-icon absent">‚úï</div>
            <div class="stat-content">
                <h3 id="absentCount">0</h3>
                <p>Absent</p>
            </div>
        </div>

        <div class="stat-card card-custom">
            <div class="stat-icon pending">üïê</div>
            <div class="stat-content">
                <h3 id="pendingCount">{{ total_students or 10 }}</h3>
                <p>Pending</p>
            </div>
        </div>
    </div>

    <!-- Face Recognition Status -->
    <div id="faceRecognitionStatus" class="face-recognition-status mb-4" style="display: none;">
        <div class="card-custom">
            <div class="card-header-custom d-flex justify-content-between align-items-center">
                <span>Face Recognition Status</span>
                <button class="btn-close" onclick="toggleFaceRecognition()">√ó</button>
            </div>
            <div class="card-body-custom">
                <div class="face-recognition-info">
                    <div class="face-stats">
                        <div class="face-stat-item">
                            <span class="face-stat-label">Cameras Detected:</span>
                            <span class="face-stat-value">2</span>
                        </div>
                        <div class="face-stat-item">
                            <span class="face-stat-label">Students Recognized:</span>
                            <span class="face-stat-value" id="recognizedCount">0</span>
                        </div>
                        <div class="face-stat-item">
                            <span class="face-stat-label">Confidence Level:</span>
                            <span class="face-stat-value">High</span>
                        </div>
                    </div>
                    <div class="face-recognition-controls">
                        <button class="btn-custom" onclick="startFaceRecognition()">
                            <span class="btn-icon">‚ñ∂Ô∏è</span>
                            Start Recognition
                        </button>
                        <button class="btn-outline-custom" onclick="stopFaceRecognition()">
                            <span class="btn-icon">‚è∏Ô∏è</span>
                            Pause
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Students Grid -->
    <div class="students-container">
        <div class="students-header mb-3">
            <h3>Student Roster</h3>
            <div class="attendance-summary">
                <span class="summary-item present">Present: <strong id="summaryPresent">0</strong></span>
                <span class="summary-item absent">Absent: <strong id="summaryAbsent">0</strong></span>
                <span class="summary-item pending">Pending: <strong id="summaryPending">{{ total_students or 10 }}</strong></span>
            </div>
        </div>
        
        <div class="students-grid" id="studentsGrid">
            {% for student in students %}
            <div class="student-card card-custom" data-id="{{ student.id }}" data-status="pending">
                <div class="student-header">
                    <div class="student-photo">
                        {% if student.photo_url %}
                        <img src="{{ student.photo_url }}" alt="{{ student.name }}">
                        {% else %}
                        <div class="student-photo-placeholder">
                            {{ student.initials }}
                        </div>
                        {% endif %}
                    </div>
                    <div class="student-info">
                        <h4>{{ student.name }}</h4>
                        <p class="student-id">{{ student.id_number }}</p>
                        <p class="student-email">{{ student.email }}</p>
                    </div>
                </div>
                
                <div class="student-status">
                    <span class="status-badge status-pending">Pending</span>
                    <span class="last-updated">‚Äî</span>
                </div>
                
                <div class="attendance-controls">
                    <div class="attendance-buttons">
                        <button class="attendance-btn present" 
                                onclick="markAttendance('{{ student.id }}', 'present')"
                                title="Mark as Present">
                            <span class="btn-icon">‚úì</span>
                            Present
                        </button>
                        <button class="attendance-btn absent" 
                                onclick="markAttendance('{{ student.id }}', 'absent')"
                                title="Mark as Absent">
                            <span class="btn-icon">‚úï</span>
                            Absent
                        </button>
                        <button class="attendance-btn late" 
                                onclick="markAttendance('{{ student.id }}', 'late')"
                                title="Mark as Late">
                            <span class="btn-icon">üïê</span>
                            Late
                        </button>
                    </div>
                    
                    <div class="attendance-notes">
                        <input type="text" 
                               class="notes-input" 
                               placeholder="Add note..."
                               data-student-id="{{ student.id }}"
                               onchange="saveNote('{{ student.id }}', this.value)">
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        {% if not students %}
        <div class="empty-state card-custom">
            <div class="empty-state-content">
                <div class="empty-state-icon">üë•</div>
                <h4>No Students Found</h4>
                <p>This class doesn't have any students enrolled yet.</p>
                <a href="{{ url_for('institution_lecturer.manage_classes') }}" class="btn-custom">Manage Roster</a>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<style>
    /* Attendance Management Specific Styles */
    .attendance-management {
        max-width: 1400px;
        margin: 0 auto;
    }

    .page-title {
        font-size: 2.5rem;
        font-weight: bold;
        font-style: italic;
        color: var(--text-dark);
        border-bottom: 2px solid var(--border-color);
        padding-bottom: 1rem;
    }

    /* Class Info Card */
    .class-info-card {
        background-color: var(--primary-dark);
        color: white;
        border-radius: 15px;
        padding: 1.5rem 2rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .class-code {
        font-size: 1.75rem;
        font-weight: bold;
        margin-bottom: 0.5rem;
    }

    .class-details {
        display: flex;
        gap: 2rem;
        flex-wrap: wrap;
    }

    .class-detail-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 1rem;
    }

    .detail-icon {
        font-size: 1.25rem;
    }

    /* Search Section */
    .search-section {
        background-color: var(--primary-light);
        border-radius: 15px;
        padding: 1.5rem;
        border: 2px solid var(--border-color);
    }

    .search-box {
        position: relative;
        flex: 1;
        max-width: 400px;
    }

    .search-box input {
        width: 100%;
        padding: 0.875rem 1rem 0.875rem 3rem;
        border: 2px solid var(--border-color);
        border-radius: 50px;
        background-color: white;
        font-size: 0.9rem;
        color: var(--text-dark);
    }

    .search-box input:focus {
        outline: none;
        border-color: var(--primary-dark);
    }

    .search-icon {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-light);
    }

    .filter-select {
        padding: 0.875rem 1rem;
        border: 2px solid var(--border-color);
        border-radius: 50px;
        background-color: white;
        font-size: 0.9rem;
        color: var(--text-dark);
        min-width: 180px;
    }

    .btn-icon {
        margin-right: 0.5rem;
    }

    .btn-success {
        background-color: #059669;
        border-color: #059669;
    }

    .btn-success:hover {
        background-color: #047857;
        border-color: #047857;
    }

    /* Stats Container */
    .stats-container {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1.5rem;
    }

    .stat-card {
        padding: 1.5rem;
        text-align: center;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
    }

    .stat-icon {
        font-size: 2.5rem;
        margin-bottom: 1rem;
    }

    .stat-icon.total {
        color: var(--primary-dark);
    }

    .stat-icon.present {
        color: #059669;
    }

    .stat-icon.absent {
        color: #dc2626;
    }

    .stat-icon.pending {
        color: #d97706;
    }

    .stat-content h3 {
        font-size: 2rem;
        font-weight: bold;
        color: var(--text-dark);
        margin-bottom: 0.25rem;
    }

    .stat-content p {
        font-size: 0.9rem;
        color: var(--text-light);
        font-weight: 600;
    }

    /* Face Recognition Status */
    .face-recognition-status {
        animation: slideDown 0.3s ease;
    }

    .face-recognition-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 2rem;
    }

    .face-stats {
        display: flex;
        gap: 2rem;
        flex-wrap: wrap;
    }

    .face-stat-item {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }

    .face-stat-label {
        font-size: 0.85rem;
        color: var(--text-light);
    }

    .face-stat-value {
        font-size: 1.25rem;
        font-weight: bold;
        color: var(--text-dark);
    }

    .face-recognition-controls {
        display: flex;
        gap: 1rem;
    }

    /* Students Container */
    .students-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .students-header h3 {
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--text-dark);
        margin: 0;
    }

    .attendance-summary {
        display: flex;
        gap: 1.5rem;
    }

    .summary-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.9rem;
    }

    .summary-item.present {
        color: #059669;
    }

    .summary-item.absent {
        color: #dc2626;
    }

    .summary-item.pending {
        color: #d97706;
    }

    .summary-item strong {
        font-size: 1.1rem;
    }

    /* Students Grid */
    .students-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1.5rem;
    }

    .student-card {
        padding: 1.5rem;
        transition: all 0.3s ease;
    }

    .student-card.present {
        border-left: 4px solid #059669;
    }

    .student-card.absent {
        border-left: 4px solid #dc2626;
    }

    .student-card.late {
        border-left: 4px solid #d97706;
    }

    .student-card.pending {
        border-left: 4px solid var(--text-light);
    }

    .student-header {
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .student-photo {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        overflow: hidden;
        border: 2px solid var(--border-color);
    }

    .student-photo img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .student-photo-placeholder {
        width: 100%;
        height: 100%;
        background-color: var(--primary-light);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        font-weight: bold;
        color: var(--primary-dark);
    }

    .student-info h4 {
        font-size: 1.1rem;
        font-weight: bold;
        color: var(--text-dark);
        margin-bottom: 0.25rem;
    }

    .student-id {
        font-size: 0.85rem;
        color: var(--primary-dark);
        font-weight: 600;
        margin-bottom: 0.125rem;
    }

    .student-email {
        font-size: 0.8rem;
        color: var(--text-light);
    }

    .student-status {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        padding-bottom: 0.75rem;
        border-bottom: 1px solid #e2e8f0;
    }

    .status-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 50px;
        font-size: 0.75rem;
        font-weight: 600;
    }

    .status-present {
        background-color: #f0fdf4;
        color: #059669;
        border: 1px solid #059669;
    }

    .status-absent {
        background-color: #fef2f2;
        color: #dc2626;
        border: 1px solid #dc2626;
    }

    .status-late {
        background-color: #fffbeb;
        color: #d97706;
        border: 1px solid #d97706;
    }

    .status-pending {
        background-color: var(--primary-light);
        color: var(--text-light);
        border: 1px solid var(--border-color);
    }

    .last-updated {
        font-size: 0.75rem;
        color: var(--text-light);
    }

    /* Attendance Controls */
    .attendance-controls {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .attendance-buttons {
        display: flex;
        gap: 0.5rem;
    }

    .attendance-btn {
        flex: 1;
        padding: 0.5rem;
        border: 2px solid;
        border-radius: 8px;
        background-color: transparent;
        font-size: 0.85rem;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.25rem;
        transition: all 0.2s ease;
    }

    .attendance-btn.present {
        color: #059669;
        border-color: #059669;
    }

    .attendance-btn.present:hover,
    .attendance-btn.present.active {
        background-color: #059669;
        color: white;
    }

    .attendance-btn.absent {
        color: #dc2626;
        border-color: #dc2626;
    }

    .attendance-btn.absent:hover,
    .attendance-btn.absent.active {
        background-color: #dc2626;
        color: white;
    }

    .attendance-btn.late {
        color: #d97706;
        border-color: #d97706;
    }

    .attendance-btn.late:hover,
    .attendance-btn.late.active {
        background-color: #d97706;
        color: white;
    }

    .attendance-notes {
        width: 100%;
    }

    .notes-input {
        width: 100%;
        padding: 0.5rem 0.75rem;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        font-size: 0.85rem;
        color: var(--text-dark);
    }

    .notes-input:focus {
        outline: none;
        border-color: var(--primary-dark);
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 3rem;
    }

    .empty-state-content {
        max-width: 400px;
        margin: 0 auto;
    }

    .empty-state-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
        color: var(--text-light);
    }

    .empty-state h4 {
        font-size: 1.5rem;
        color: var(--text-dark);
        margin-bottom: 0.5rem;
    }

    .empty-state p {
        color: var(--text-light);
        margin-bottom: 1.5rem;
    }

    /* Responsive */
    @media (max-width: 1200px) {
        .stats-container {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .students-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .face-recognition-info {
            flex-direction: column;
            align-items: stretch;
        }
    }

    @media (max-width: 768px) {
        .page-title {
            font-size: 1.75rem;
        }
        
        .class-info-card {
            padding: 1rem;
        }
        
        .class-code {
            font-size: 1.25rem;
        }
        
        .class-details {
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .search-section .d-flex {
            flex-direction: column;
            align-items: stretch;
        }
        
        .search-box {
            max-width: 100%;
        }
        
        .stats-container {
            grid-template-columns: 1fr;
        }
        
        .students-grid {
            grid-template-columns: 1fr;
        }
        
        .students-header {
            flex-direction: column;
            align-items: stretch;
        }
        
        .attendance-summary {
            justify-content: space-between;
        }
        
        .attendance-buttons {
            flex-direction: column;
        }
    }

    @media (max-width: 576px) {
        .face-stats {
            flex-direction: column;
            gap: 1rem;
        }
        
        .face-recognition-controls {
            flex-direction: column;
        }
        
        .attendance-summary {
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .student-header {
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        
        .student-status {
            flex-direction: column;
            gap: 0.5rem;
            align-items: flex-start;
        }
    }

    /* Animations */
    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>

{% block scripts %}
<script>
    // Attendance data
    let attendanceData = {};
    let faceRecognitionActive = false;
    
    // Initialize attendance data
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize attendance data from server or localStorage
        const savedData = localStorage.getItem(`attendance_${getClassId()}`);
        if (savedData) {
            attendanceData = JSON.parse(savedData);
            loadAttendanceData();
        }
        
        updateCounts();
    });
    
    function getClassId() {
        // Extract class ID from URL or use default
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('class_id') || 'default';
    }
    
    function markAttendance(studentId, status) {
        // Update student card
        const card = document.querySelector(`.student-card[data-id="${studentId}"]`);
        if (!card) return;
        
        // Remove existing status classes
        card.classList.remove('present', 'absent', 'late', 'pending');
        card.classList.add(status);
        
        // Update status badge
        const statusBadge = card.querySelector('.status-badge');
        statusBadge.className = `status-badge status-${status}`;
        statusBadge.textContent = status.charAt(0).toUpperCase() + status.slice(1);
        
        // Update button states
        const buttons = card.querySelectorAll('.attendance-btn');
        buttons.forEach(btn => {
            btn.classList.remove('active');
            if (btn.classList.contains(status)) {
                btn.classList.add('active');
            }
        });
        
        // Update last updated time
        const lastUpdated = card.querySelector('.last-updated');
        const now = new Date();
        lastUpdated.textContent = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        
        // Update attendance data
        attendanceData[studentId] = {
            status: status,
            timestamp: now.toISOString(),
            note: card.querySelector('.notes-input').value
        };
        
        // Save to localStorage
        saveAttendanceData();
        
        // Update counts
        updateCounts();
        
        // Show confirmation
        showToast(`Attendance marked as ${status} for student`, 'success');
    }
    
    function saveNote(studentId, note) {
        if (attendanceData[studentId]) {
            attendanceData[studentId].note = note;
            saveAttendanceData();
        }
    }
    
    function saveAttendanceData() {
        localStorage.setItem(`attendance_${getClassId()}`, JSON.stringify(attendanceData));
    }
    
    function loadAttendanceData() {
        Object.keys(attendanceData).forEach(studentId => {
            const data = attendanceData[studentId];
            markAttendance(studentId, data.status);
            
            // Restore note
            const noteInput = document.querySelector(`.notes-input[data-student-id="${studentId}"]`);
            if (noteInput && data.note) {
                noteInput.value = data.note;
            }
        });
    }
    
    function updateCounts() {
        const cards = document.querySelectorAll('.student-card');
        let present = 0, absent = 0, late = 0, pending = 0;
        
        cards.forEach(card => {
            if (card.classList.contains('present')) present++;
            else if (card.classList.contains('absent')) absent++;
            else if (card.classList.contains('late')) late++;
            else pending++;
        });
        
        // Update stats cards
        document.getElementById('presentCount').textContent = present;
        document.getElementById('absentCount').textContent = absent;
        document.getElementById('pendingCount').textContent = pending;
        
        // Update summary
        document.getElementById('summaryPresent').textContent = present;
        document.getElementById('summaryAbsent').textContent = absent;
        document.getElementById('summaryPending').textContent = pending;
    }
    
    function searchStudents() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const cards = document.querySelectorAll('.student-card');
        
        cards.forEach(card => {
            const name = card.querySelector('h4').textContent.toLowerCase();
            const id = card.querySelector('.student-id').textContent.toLowerCase();
            const email = card.querySelector('.student-email').textContent.toLowerCase();
            
            if (name.includes(searchTerm) || id.includes(searchTerm) || email.includes(searchTerm)) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    }
    
    function filterStudents() {
        const filter = document.getElementById('statusFilter').value;
        const cards = document.querySelectorAll('.student-card');
        
        cards.forEach(card => {
            if (filter === 'all') {
                card.style.display = 'block';
            } else if (filter === 'present' && card.classList.contains('present')) {
                card.style.display = 'block';
            } else if (filter === 'absent' && card.classList.contains('absent')) {
                card.style.display = 'block';
            } else if (filter === 'pending' && 
                      (card.classList.contains('pending') || 
                       (!card.classList.contains('present') && 
                        !card.classList.contains('absent') && 
                        !card.classList.contains('late')))) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    }
    
    function toggleFaceRecognition() {
        const statusPanel = document.getElementById('faceRecognitionStatus');
        statusPanel.style.display = statusPanel.style.display === 'none' ? 'block' : 'none';
    }
    
    function startFaceRecognition() {
        faceRecognitionActive = true;
        showToast('Face recognition started', 'info');
        
        // Simulate face recognition
        simulateFaceRecognition();
    }
    
    function stopFaceRecognition() {
        faceRecognitionActive = false;
        showToast('Face recognition stopped', 'info');
    }
    
    function simulateFaceRecognition() {
        if (!faceRecognitionActive) return;
        
        // Simulate recognizing some students
        const pendingCards = document.querySelectorAll('.student-card.pending, .student-card:not(.present):not(.absent):not(.late)');
        if (pendingCards.length > 0) {
            // Randomly mark some as present
            const randomIndex = Math.floor(Math.random() * pendingCards.length);
            const randomCard = pendingCards[randomIndex];
            const studentId = randomCard.dataset.id;
            
            markAttendance(studentId, 'present');
            
            // Update recognized count
            const recognizedElement = document.getElementById('recognizedCount');
            recognizedElement.textContent = parseInt(recognizedElement.textContent) + 1;
            
            // Continue after delay
            setTimeout(simulateFaceRecognition, 2000);
        }
    }
    
    function saveAttendance() {
        // In a real app, this would send data to the server
        const dataToSave = {
            class_id: getClassId(),
            attendance: attendanceData,
            timestamp: new Date().toISOString()
        };
        
        console.log('Saving attendance:', dataToSave);
        
        // Simulate API call
        setTimeout(() => {
            showToast('Attendance saved successfully!', 'success');
            // Clear localStorage after successful save
            localStorage.removeItem(`attendance_${getClassId()}`);
            attendanceData = {};
        }, 1000);
    }
    
    function refreshAttendance() {
        // Clear local storage and reset
        localStorage.removeItem(`attendance_${getClassId()}`);
        attendanceData = {};
        
        // Reset all cards
        const cards = document.querySelectorAll('.student-card');
        cards.forEach(card => {
            card.classList.remove('present', 'absent', 'late');
            card.classList.add('pending');
            
            const statusBadge = card.querySelector('.status-badge');
            statusBadge.className = 'status-badge status-pending';
            statusBadge.textContent = 'Pending';
            
            const buttons = card.querySelectorAll('.attendance-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            const lastUpdated = card.querySelector('.last-updated');
            lastUpdated.textContent = '‚Äî';
            
            const noteInput = card.querySelector('.notes-input');
            if (noteInput) noteInput.value = '';
        });
        
        updateCounts();
        showToast('Attendance refreshed', 'info');
    }
    
    function showToast(message, type = 'info') {
        // Create toast element
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        toast.textContent = message;
        toast.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: ${type === 'success' ? '#f0fdf4' : type === 'warning' ? '#fffbeb' : '#f0f9ff'};
            color: ${type === 'success' ? '#059669' : type === 'warning' ? '#d97706' : '#0891b2'};
            border: 2px solid ${type === 'success' ? '#059669' : type === 'warning' ? '#d97706' : '#0891b2'};
            padding: 1rem 1.5rem;
            border-radius: 8px;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        `;
        
        document.body.appendChild(toast);
        
        // Remove toast after 3 seconds
        setTimeout(() => {
            toast.style.animation = 'slideOut 0.3s ease';
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    }
    
    // Add CSS for animations
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
    `;
    document.head.appendChild(style);
</script>
{% endblock %}
{% endblock %}